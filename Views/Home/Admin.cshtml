@model IEnumerable<FacilityManagement.Models.Facility>
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Admin Dashboard</h2>
    <div>
        <a asp-controller="Facility" asp-action="Create" class="btn btn-primary">Create New Facility</a>
        <a asp-controller="User" asp-action="Create" class="btn btn-success">Add New User</a>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>All Facilities Overview</h5>
            </div>
            <div class="card-body">
                @if (Model.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Owner</th>
                                    <th>Address</th>
                                    <th>Total Units</th>
                                    <th>Occupied Units</th>
                                    <th>Occupancy Rate</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var facility in Model)
                                {
                                    var totalUnits = facility.StorageUnits.Count();
                                    var occupiedUnits = facility.StorageUnits.Count(u => u.IsOccupied);
                                    var occupancyRate = totalUnits > 0 ? (double)occupiedUnits / totalUnits * 100 : 0;

                                    <tr>
                                        <td>
                                            <strong>@facility.Name</strong>
                                            @if (!string.IsNullOrEmpty(facility.Description))
                                            {
                                                <br>

                                                <small class="text-muted">@facility.Description</small>
                                            }
                                        </td>
                                        <td>@facility.Owner.FullName</td>
                                        <td>
                                            @facility.Address
                                            @if (!string.IsNullOrEmpty(facility.City))
                                            {
                                                <br>

                                                <small>@facility.City @facility.PostalCode</small>
                                            }
                                        </td>
                                        <td>@totalUnits</td>
                                        <td>@occupiedUnits</td>
                                        <td>
                                            <div class="progress" style="height: 20px;">
                                                <div class="progress-bar @(occupancyRate > 80 ? "bg-success" : occupancyRate > 50 ? "bg-warning" : "bg-danger")"
                                                    role="progressbar" style="width: @occupancyRate%"
                                                    aria-valuenow="@occupancyRate" aria-valuemin="0" aria-valuemax="100">
                                                    @occupancyRate.ToString("F0")%
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a asp-controller="Facility" asp-action="Details" asp-route-id="@facility.Id"
                                                    class="btn btn-sm btn-outline-info">View</a>
                                                <a asp-controller="Facility" asp-action="Edit" asp-route-id="@facility.Id"
                                                    class="btn btn-sm btn-outline-warning">Edit</a>
                                                <a asp-controller="StorageUnit" asp-action="Index"
                                                    asp-route-facilityId="@facility.Id"
                                                    class="btn btn-sm btn-outline-primary">Units</a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center py-4">
                        <p class="text-muted">No facilities have been created yet.</p>
                        <a asp-controller="Facility" asp-action="Create" class="btn btn-primary">Create Your First
                            Facility</a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6>Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a asp-controller="User" asp-action="Index" class="btn btn-outline-primary">Manage Users</a>
                    <a asp-controller="StorageUnit" asp-action="Index" class="btn btn-outline-secondary">All Storage
                        Units</a>
                    <a asp-controller="Facility" asp-action="Index" class="btn btn-outline-info">All Facilities</a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h6>Recent Activity</h6>
            </div>
            <div class="card-body">
                <p class="text-muted">Activity tracking will be implemented in future updates.</p>
            </div>
        </div>
    </div>
</div>
